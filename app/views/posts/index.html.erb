<div style="max-width: 1000px; margin: 40px auto; padding: 0 20px;">
  <div style="display: flex; justify-content: space-between; align-items: center; margin-bottom: 30px;">
    <h1 style="font-size: 28px; font-weight: bold;">My Collection</h1>
    <%= link_to "新しい盤を登録する", new_post_path, class: "btn-primary" %>
  </div>

  <%# 検索・絞り込みフォーム %>
  <div style="margin-bottom: 30px; background: #fff; padding: 20px; border: 1px solid #e5e5e5; border-radius: 4px;">
    <%= form_with url: posts_path, method: :get, local: true, style: "display: flex; gap: 15px; align-items: center;" do |f| %>
      <div style="flex: 2;">
        <%= f.text_field :search, value: params[:search], placeholder: "アーティスト名・タイトルで検索",
            style: "padding: 10px; width: 100%; border: 1px solid #ccc; border-radius: 4px; box-sizing: border-box;" %>
      </div>
      <div style="flex: 1;">
        <%= f.select :genre, Post::GENRES, { include_blank: "すべてのジャンル", selected: params[:genre] },
            { style: "padding: 10px; width: 100%; border: 1px solid #ccc; border-radius: 4px; background: white;" } %>
      </div>
      <%= f.submit "検索", style: "padding: 10px 20px; cursor: pointer; background: #333; color: white; border: none; border-radius: 4px; font-weight: bold;" %>
      <% if params[:search].present? || params[:genre].present? %>
        <%= link_to "リセット", posts_path, style: "font-size: 12px; color: #666; text-decoration: none;" %>
      <% end %>
    <% end %>
  </div>

  <%# データがある場合のみグリッドを表示 %>
  <% if @posts.any? %>
    <div style="display: grid; grid-template-columns: repeat(auto-fill, minmax(180px, 1fr)); gap: 20px;">
      <% @posts.each do |post| %>
        <div class="record-card">
          <%= link_to post, style: "text-decoration: none; color: inherit;" do %>
            <div class="image-container">
              <% if post.image.attached? %>
                <%= image_tag post.image %>
              <% else %>
                <span style="color: #999; font-size: 12px;">No Image</span>
              <% end %>
            </div>
            <div class="card-info">
              <span class="record-title"><%= post.title %></span>
              <span class="record-artist text-gray-600"><%= post.artist %></span>
              <% if post.genre.present? %>
                <span style="display: inline-block; margin-top: 5px; font-size: 10px; background: #eee; padding: 2px 6px; border-radius: 10px; color: #666;">
                  <%= post.genre %>
                </span>
              <% end %>
            </div>
          <% end %>
          <div style="padding: 0 12px 12px; display: flex; gap: 10px; font-size: 11px;">
            <%= link_to "編集", edit_post_path(post), style: "color: #007bff; text-decoration: none;" %>
            <%= button_to "削除", post,
              method: :delete,
              data: { turbo_confirm: t('common.confirm_delete') },
              style: "background: none; border: none; color: #dc3545; cursor: pointer; padding: 0; font-size: 11px;" %>
          </div>
        </div>
      <% end %>
    </div>
  <% else %>
    <%# --- 空の状態のケア (Empty State) --- %>
    <div style="text-align: center; padding: 100px 20px; background: #fff; border: 1px dashed #ccc; border-radius: 8px;">
      <div style="font-size: 48px; margin-bottom: 20px;">💿</div>
      <h2 style="font-size: 20px; color: #333; margin-bottom: 10px;">
        <%= params[:search].present? || params[:genre].present? ? "条件に合う盤が見つかりませんでした" : "コレクションがまだありません" %>
      </h2>
      <p style="color: #666; margin-bottom: 30px;">
        お気に入りのレコードを登録して、自分だけのデータベースを作りましょう。
      </p>
      <%= link_to "最初の1枚を登録する", new_post_path, class: "btn-primary", style: "padding: 12px 30px;" %>
    </div>
  <% end %>

  <div style="margin-top: 40px;">
    <%= paginate @posts %>
  </div>
</div>
